name: Move numbered files to pages
on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  move-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure git user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Create or switch to branch
        run: |
          BRANCH="move-numbered-to-pages"
          # create branch from default branch
          git fetch origin
          git checkout -b "$BRANCH" || git checkout "$BRANCH"

      - name: Ensure pages/ exists
        run: mkdir -p pages

      - name: Move numbered files (01..12 -> pages/)
        run: |
          set -euo pipefail
          moved=false
          # patterns: 01..09 and 10..12
          for f in 0[1-9]* 1[0-2]*; do
            # skip directories and patterns that don't exist
            if [ -e "$f" ] && [ ! -d "$f" ]; then
              target="pages/$(basename "$f")"
              # prefer git mv to preserve history; if that fails, fallback to copy+remove
              if git ls-files --error-unmatch "$f" >/dev/null 2>&1; then
                git mv "$f" "$target" || (cp "$f" "$target" && git add "$target" && git rm "$f")
              else
                # file not tracked by git (untracked), just move it and add
                mv "$f" "$target"
                git add "$target"
              fi
              moved=true
              echo "Moved: $f -> $target"
            fi
          done
          if [ "$moved" = "false" ]; then
            echo "No matching files found to move."
          fi

      - name: Commit & push changes (if any)
        run: |
          if git status --porcelain | grep -q .; then
            git add -A
            git commit -m "Move numbered files (02–12) into pages/ directory" || echo "Commit failed or no changes to commit"
            git push --set-upstream origin HEAD
          else
            echo "No changes to commit."
          fi

      - name: Create pull request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Move numbered files (02–12) into pages/ directory"
          branch: move-numbered-to-pages
          title: "Move numbered files into pages/"
          body: |
            This automated change moves files starting with 02..12 from repository root into the pages/ directory.
            If you want a different branch name or base branch, edit the workflow before running.
          base: main
